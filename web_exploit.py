import os
import subprocess
import re

def check_tool_installed(tool):
    """Check if a tool is installed on the system."""
    try:
        subprocess.check_output([tool, "-h"], stderr=subprocess.PIPE)
        return True
    except subprocess.CalledProcessError:
        return False

def is_valid_url(target):
    """Validate the format of the domain/IP."""
    # Regex for validating domain or IP address format
    url_pattern = re.compile(r'^(http://|https://)?([a-zA-Z0-9.-]+|[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})$')
    return re.match(url_pattern, target) is not None

def run():
    target = input("\nEnter target domain/IP (without http://): ").strip()

    if not target:
        print("[!] No target provided. Exiting...\n")
        return

    # Validate the target URL/IP format
    if not is_valid_url(target):
        print("[!] Invalid domain/IP format. Please provide a valid URL or IP.\n")
        return

    # Check if the required tools (dirb and nikto) are installed
    if not check_tool_installed("dirb"):
        print("[!] dirb is not installed. Please install dirb and try again.\n")
        return

    if not check_tool_installed("nikto"):
        print("[!] nikto is not installed. Please install nikto and try again.\n")
        return

    print(f"\n[+] Running web exploitation tools on {target}...\n")

    # Run dirb scan
    print("[+] Running dirb scan...\n")
    try:
        dirb_output = subprocess.check_output(f"dirb http://{target}", shell=True, stderr=subprocess.PIPE).decode()
        print(dirb_output)
    except subprocess.CalledProcessError as e:
        print(f"[!] Error running dirb: {e.stderr.decode()}\n")

    # Run nikto scan
    print("\n[+] Running nikto scan...\n")
    try:
        nikto_output = subprocess.check_output(f"nikto -h http://{target}", shell=True, stderr=subprocess.PIPE).decode()
        print(nikto_output)
    except subprocess.CalledProcessError as e:
        print(f"[!] Error running nikto: {e.stderr.decode()}\n")

    print("\n[+] Web exploitation scans completed!\n")

